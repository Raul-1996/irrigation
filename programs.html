<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WB-Irrigation ‚Äî –ü—Ä–æ–≥—Ä–∞–º–º—ã</title>
  <script src="https://unpkg.com/htmx.org@1.9.2"></script>
  <style>
    body{font-family:sans-serif;margin:0;background:#f4f6f8;color:#333}
    header,footer{background:#263238;color:#fff;padding:1rem;text-align:center}
    nav{background:#37474f;display:flex;justify-content:center;padding:.5rem 0}
    nav a{color:#fff;text-decoration:none;margin:0 1rem;font-weight:700;font-size:.95rem}
    nav a.active{border-bottom:2px solid #fff}
    main{padding:2rem;max-width:1200px;margin:auto;}
    .float-add{display:block;margin:0 auto 1rem;background:#2196f3;color:#fff;border:none;padding:.6rem 1rem;border-radius:5px;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,.2);font-size:1rem}
    .prog-table{width:100%;border-collapse:collapse;background:#fff}
    th,td{border:1px solid #ccc;padding:.6rem;text-align:center;font-size:.9rem}
    th{background:#e0e0e0}
    button{padding:.4rem .8rem;border:none;border-radius:4px;cursor:pointer;font-size:.9rem}
    .edit-btn{background:#ffc107;color:#000;margin-right:.4rem}
    .del-btn{background:#f44336;color:#fff}
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);justify-content:center;align-items:center}
    .modal-content{background:#fff;padding:2rem;border-radius:6px;max-width:600px;width:90%;max-height:90%;overflow:auto}
    .wizard-step{display:none}
    .wizard-step.active{display:block}
    .wizard-nav{display:flex;justify-content:space-between;margin-top:1rem}
    .wizard-nav button{background:#4caf50;color:#fff;padding:.6rem 1rem;border:none;border-radius:4px;cursor:pointer}
    .wizard-nav .cancel{background:#ccc;color:#333}
    .field{margin-bottom:1rem;text-align:left}
    .field label{display:block;margin-bottom:.3rem}
    .field input[type=text], .field input[type=time], .field select{width:100%;padding:.4rem;border:1px solid #ccc;border-radius:4px}
    .select-days{margin-bottom:.5rem}
    .zone-selector{border:1px solid #ccc;padding:1rem;border-radius:4px;max-height:300px;overflow:auto;margin-bottom:1rem}
    .group-block{margin-bottom:0.75rem}
    .group-block > label{font-weight:bold;display:block;margin-bottom:0.5rem;cursor:pointer}
    .zone-item{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));grid-gap:0.5rem;padding-left:1.5rem}
    .select-all{display:block;margin-bottom:1rem;font-weight:bold;cursor:pointer}
  </style>
</head>
<body>
  <header><h1>WB-Irrigation ‚Äî –ü—Ä–æ–≥—Ä–∞–º–º—ã</h1></header>
  <nav>
    <a href="status.html">–°—Ç–∞—Ç—É—Å</a>
    <a href="zones.html">–ó–æ–Ω—ã</a>
    <a href="programs.html" class="active">–ü—Ä–æ–≥—Ä–∞–º–º—ã</a>
    <a href="logs.html">–õ–æ–≥–∏</a>
    <a href="water.html">–†–∞—Å—Ö–æ–¥</a>
  </nav>
  <main>
    <button class="float-add" onclick="openWizard()">‚ûï –ù–æ–≤–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</button>
    <table class="prog-table">
      <thead>
        <tr><th>#</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–í—Ä–µ–º—è —Å—Ç–∞—Ä—Ç–∞</th><th>–î–Ω–∏ –Ω–µ–¥–µ–ª–∏</th><th>–ó–æ–Ω—ã</th><th>‚úè</th><th>üóëÔ∏è</th></tr>
      </thead>
      <tbody id="prog-body"></tbody>
    </table>
  </main>
  <div class="modal" id="wizardModal">
    <div class="modal-content">
      <div class="wizard-step" id="step1">
        <h3>–®–∞–≥ 1: –ò–º—è, –≤—Ä–µ–º—è –∏ –¥–Ω–∏</h3>
        <div class="field"><label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã *</label><input id="progName" type="text" required/></div>
        <div class="field"><label>–í—Ä–µ–º—è —Å—Ç–∞—Ä—Ç–∞ * (–º–∏–Ω. —à–∞–≥ 5)</label><input id="progTime" type="time" step="300" required/></div>
        <div class="field">
          <label>–î–Ω–∏ –Ω–µ–¥–µ–ª–∏ *</label>
          <button class="select-days" onclick="selectAllDays()">–í—Å–µ –¥–Ω–∏</button>
          <select id="progDays" multiple required>
            <option>–ü–Ω</option><option>–í—Ç</option><option>–°—Ä</option><option>–ß—Ç</option><option>–ü—Ç</option><option>–°–±</option><option>–í—Å</option>
          </select>
        </div>
      </div>
      <div class="wizard-step" id="step2">
        <h3>–®–∞–≥ 2: –í—ã–±–æ—Ä –∑–æ–Ω –∏–ª–∏ –≥—Ä—É–ø–ø *</h3>
        <label class="select-all"><input type="checkbox" id="selectAllZones" onclick="toggleAllZones(this)"> –í—ã–±—Ä–∞—Ç—å –≤—Å–µ –≥—Ä—É–ø–ø—ã –∏ –∑–æ–Ω—ã</label>
        <div class="zone-selector" id="zoneSelector"></div>
      </div>
      <div class="wizard-nav">
        <button id="prevBtn" onclick="prevStep()" disabled>–ù–∞–∑–∞–¥</button>
        <button id="nextBtn" onclick="nextStep()">–î–∞–ª–µ–µ</button>
        <button id="saveBtn" onclick="saveProg()" style="display:none;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="cancel" onclick="closeWizard()">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>
  <footer>–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã –∞–∫—Ç—É–∞–ª–µ–Ω –Ω–∞ 01.05.2025 00:00</footer>
  <script>
    const programs=[
      {id:1,name:'–£—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ–ª–∏–≤',time:'06:00',days:['–ü–Ω','–°—Ä','–ü—Ç'],zones:[1,2,3]},
      {id:2,name:'–í–µ—á–µ—Ä–Ω–∏–π –ø–æ–ª–∏–≤',time:'18:00',days:['–í—Ç','–ß—Ç'],zones:[5,6]},
      {id:3,name:'–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–æ–ª–∏–≤',time:'07:00',days:['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'],zones:Array.from({length:12},(_,i)=>i+1)},
      {id:4,name:'–í—ã—Ö–æ–¥–Ω–æ–π –ø–æ–ª–∏–≤',time:'09:00',days:['–°–±','–í—Å'],zones:Array.from({length:12},(_,i)=>13+i)},
      {id:5,name:'–ü–æ–ª—É–¥–µ–Ω–Ω—ã–π –ø–æ–ª–∏–≤',time:'12:30',days:['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç'],zones:[25,26,27,28,29]}
    ];
    function renderList(){
      const tbody=document.getElementById('prog-body');
      programs.forEach(p=>{
        const tr=document.createElement('tr');
        tr.innerHTML=\`<td>\${p.id}</td><td>\${p.name}</td><td>\${p.time}</td><td>\${p.days.join(', ')}</td><td>\${p.zones.length>6?p.zones[0]+'-'+p.zones[p.zones.length-1]:p.zones.join(', ')}</td><td><button class="edit-btn" onclick="editProg(\${p.id})">‚úè</button></td><td><button class="del-btn" onclick="deleteProg(\${p.id})">üóëÔ∏è</button></td>\`;
        tbody.appendChild(tr);
      });
    }
    renderList();
    let currentStep=1,editId=null;
    function openWizard(){closeWizard();document.getElementById('wizardModal').style.display='flex';showStep(1);loadZoneSelector();clearFields();}
    function editProg(id){const p=programs.find(x=>x.id===id);if(!p)return;editId=id;document.getElementById('wizardModal').style.display='flex';showStep(1);loadZoneSelector();document.getElementById('progName').value=p.name;document.getElementById('progTime').value=p.time;Array.from(document.getElementById('progDays').options).forEach(o=>o.selected=p.days.includes(o.value));document.querySelectorAll('.zone-check').forEach(cb=>cb.checked=p.zones.includes(+cb.value));}
    function deleteProg(id){if(confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É ‚Ññ'+id+'?')){const idx=programs.findIndex(x=>x.id===id);programs.splice(idx,1);document.getElementById('prog-body').innerHTML='';renderList();}}
    function clearFields(){document.getElementById('progName').value='';document.getElementById('progTime').value='';Array.from(document.getElementById('progDays').options).forEach(o=>o.selected=false);document.querySelectorAll('.zone-check').forEach(cb=>cb.checked=false);editId=null;}
    function closeWizard(){document.getElementById('wizardModal').style.display='none';}
    function showStep(n){[1,2].forEach(i=>document.getElementById('step'+i).classList.toggle('active',i===n));document.getElementById('prevBtn').disabled=n===1;document.getElementById('nextBtn').style.display=n<2?'inline-block':'none';document.getElementById('saveBtn').style.display=n===2?'inline-block':'none';currentStep=n;}
    function nextStep(){if(currentStep<2)showStep(currentStep+1);}function prevStep(){if(currentStep>1)showStep(currentStep-1);}
    function selectAllDays(){Array.from(document.getElementById('progDays').options).forEach(o=>o.selected=true);}
    function loadZoneSelector(){const c=document.getElementById('zoneSelector');c.innerHTML='';for(let g=1;g<=4;g++){const grp=document.createElement('div');grp.className='group-block';grp.innerHTML=\`<label><input type='checkbox' class='group-check' data-group='\${g}' onclick='toggleGroup(\${g}, this)'> –ì—Ä—É–ø–ø–∞ \${g}</label>\`;const box=document.createElement('div');box.className='zone-item';for(let z=(g-1)*12+1;z<=g*12;z++){const lbl=document.createElement('label');lbl.innerHTML=\`<input type='checkbox' class='zone-check' data-group='\${g}' value='\${z}'> –ó–æ–Ω–∞ \${z}\`;box.appendChild(lbl);}grp.appendChild(box);c.appendChild(grp);} }
    function toggleAllZones(cb){document.querySelectorAll('.group-check, .zone-check').forEach(ch=>ch.checked=cb.checked);}
    function toggleGroup(group, cb){document.querySelectorAll(\`.zone-check[data-group='${group}']\`).forEach(ch=>ch.checked=cb.checked);}
    function saveProg(){const name=document.getElementById('progName').value;const time=document.getElementById('progTime').value;const days=Array.from(document.getElementById('progDays').selectedOptions).map(o=>o.value);const zones=Array.from(document.querySelectorAll('.zone-check:checked')).map(cb=>+cb.value);if(!name||!time||!days.length||!zones.length){alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∑–æ–Ω—ã');return;}if(editId){const p=programs.find(x=>x.id===editId);p.name=name;p.time=time;p.days=days;p.zones=zones;}else{const id=programs.length?Math.max(...programs.map(x=>x.id))+1:1;programs.push({id,name,time,days,zones});}document.getElementById('prog-body').innerHTML='';renderList();closeWizard();}
  </script>
</body>
</html>