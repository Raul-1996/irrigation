<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WB-Irrigation — Расход воды</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body{font-family:sans-serif;margin:0;background:#f4f6f8;color:#333}
    header,footer{background:#263238;color:#fff;padding:1rem;text-align:center}
    nav{background:#37474f;display:flex;justify-content:center;padding:.5rem 0}
    nav a{color:#fff;text-decoration:none;margin:0 1rem;font-weight:700;font-size:.95rem}
    nav a.active{border-bottom:2px solid #fff}
    main{padding:2rem;max-width:1200px;margin:auto}
    .counter-box{background:#fff;padding:1rem;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,.1);margin-bottom:1rem;display:flex;justify-content:space-between;align-items:center;font-size:1rem}
    .controls{display:flex;gap:1rem;flex-wrap:wrap;align-items:center;margin-bottom:1rem}
    .controls label{font-size:.9rem}
    .controls select{padding:.4rem;border:1px solid #ccc;border-radius:4px;font-size:.9rem}
    .chart-container{background:#fff;padding:1rem;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,.1);margin-bottom:1rem}
    table{width:100%;border-collapse:collapse;background:#fff;font-size:.9rem}
    th,td{border:1px solid #ccc;padding:.5rem;text-align:center}
    th{background:#e0e0e0}
  </style>
</head>
<body>
  <header><h1>WB-Irrigation — Расход воды</h1></header>
  <nav>
    <a href="status.html">Статус</a>
    <a href="zones.html">Зоны</a>
    <a href="programs.html">Программы</a>
    <a href="logs.html">Логи</a>
    <a href="water.html" class="active">Расход</a>
  </nav>
  <main>
    <div class="counter-box">
      <div>Текущий счётчик: <strong id="currentCounter">123456</strong> импульсов</div>
      <div>Ток. расход: <strong id="currentUsage">—</strong> л</div>
    </div>
    <div class="controls">
      <label>Период: <select id="periodSelect"><option value="7">7 дней</option><option value="30">30 дней</option></select></label>
      <label>Зона: <select id="zoneSelect"><option value="all">Все зоны</option></select></label>
      <button onclick="updateChart()">Обновить</button>
    </div>
    <div class="chart-container"><canvas id="usageChart"></canvas></div>
    <h2>Лог расхода</h2>
    <table><thead><tr><th>Дата</th><th>Зона</th><th>Расход (л)</th></tr></thead><tbody id="log-table"></tbody></table>
  </main>
  <footer>Статус системы актуален на 01.05.2025 00:00</footer>
  <script>
    // Демо-страница расхода воды: генерация данных, график и лог
    // Ссылка на выбор периода для корректной работы updateChart
    const periodSelect=document.getElementById('periodSelect');
    const zoneSelect=document.getElementById('zoneSelect');
    for(let i=1;i<=48;i++){const opt=document.createElement('option');opt.value=i;opt.textContent='Зона '+i;zoneSelect.appendChild(opt);}
    function generateData(days, zone){
      const labels=[],data=[],logRows=[];
      for(let i=days-1;i>=0;i--){
        const d=new Date(); d.setDate(d.getDate()-i);
        const day=d.toISOString().slice(0,10);
        labels.push(day.slice(8)+'.'+day.slice(5,7));
        const usage=Math.floor(Math.random()*50)+10;
        data.push(usage);
        logRows.push({date:day,zone:zone==='all'?'all':zone,usage});
      }
      return {labels,data,logRows};
    }
    const ctx=document.getElementById('usageChart').getContext('2d');
    const chart=new Chart(ctx,{type:'line',data:{labels:[],datasets:[{label:'Расход воды (л)',data:[],fill:false,tension:0.1}]},options:{responsive:true,scales:{x:{display:true},y:{beginAtZero:true}}}});
    function updateChart(){
      const days=+periodSelect.value,zone=zoneSelect.value;
      const {labels,data,logRows}=generateData(days,zone);
      chart.data.labels=labels;chart.data.datasets[0].data=data;chart.update();
      const tbody=document.getElementById('log-table');tbody.innerHTML='';
      logRows.forEach(r=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${r.date}</td><td>${r.zone}</td><td>${r.usage}</td>`;tbody.appendChild(tr);});
      document.getElementById('currentUsage').textContent=data[data.length-1];
    }
    updateChart();
  </script>
</body>
</html>