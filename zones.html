<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WB-Irrigation ‚Äî –ó–æ–Ω—ã</title>
  <script src="https://unpkg.com/htmx.org@1.9.2"></script>
  <style>
    body{font-family:sans-serif;margin:0;background:#f4f6f8;color:#333}
    header,footer{background:#263238;color:#fff;padding:1rem;text-align:center}
    nav{background:#37474f;display:flex;justify-content:center;padding:.5rem 0}
    nav a{color:#fff;text-decoration:none;margin:0 1rem;font-weight:700;font-size:.95rem}
    nav a.active{border-bottom:2px solid #fff}
    nav a:hover{text-decoration:underline}
    main{padding:2rem;max-width:1200px;margin:auto;position:relative}
    .float-add{display:block;margin:0 auto 1rem;background:#2196f3;color:#fff;border:none;padding:.6rem 1rem;border-radius:5px;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,.2);font-size:1rem}
    .zones-table{width:100%;border-collapse:collapse;background:#fff;margin-top:1rem}
    th,td{border:1px solid #ccc;padding:.5rem;text-align:center;font-size:.9rem}
    th{background:#e0e0e0}
    .indicator{width:12px;height:12px;border-radius:50%;display:inline-block}
    .on{background:green}.off{background:red}
    input[type="text"], input[type="number"], select{width:100%;padding:.3rem;border:1px solid #ccc;border-radius:4px;font-size:.9rem}
    button.save-btn, button.del-btn, button.start-btn{padding:.3rem .6rem;border:2px solid #fff;border-radius:4px;cursor:pointer;font-size:.85rem}
    .save-btn{background:#4caf50;color:#fff;border-color:#fff}
    .save-btn:disabled{opacity:.5;cursor:default}
    .del-btn{background:#f44336;color:#fff;border-color:#fff}
    .start-btn{background:#2196f3;color:#fff;border-color:#fff}
    .bulk-actions{background:#fff;padding:1rem;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,.1);margin-top:1rem;}
    .bulk-actions h3{margin-top:0;font-size:1rem}
    .bulk-actions .controls{display:flex;gap:1rem;flex-wrap:wrap;align-items:center}
    .bulk-actions label{display:flex;align-items:center;gap:.5rem;font-size:.9rem}
    .bulk-actions select,input[type="number"]{width:auto;flex:1;min-width:120px}
    .bulk-actions button{padding:.5rem 1rem;border:none;border-radius:4px;cursor:pointer;background:#4caf50;color:#fff;font-size:.9rem;}
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);justify-content:center;align-items:center}
    .modal-content{background:#fff;padding:1.5rem;border-radius:6px;max-width:400px;width:90%}
    .modal-content h3{margin-top:0}
    .modal-content .field{margin-bottom:1rem;text-align:left}
    .modal-content label{display:block;margin-bottom:.3rem;font-size:.9rem}
    .modal-content input, .modal-content select{width:100%;padding:.3rem;border:1px solid #ccc;border-radius:4px}
    .modal-content button{margin-right:.5rem;padding:.4rem .8rem;border:none;border-radius:4px;cursor:pointer;font-size:.9rem}
    .modal-content .create-btn{background:#4caf50;color:#fff}
    .modal-content .cancel-btn{background:#ccc;color:#333}
  </style>
</head>
<body>
  <header><h1>WB-Irrigation ‚Äî –ó–æ–Ω—ã</h1></header>
  <nav>
    <a href="status.html">–°—Ç–∞—Ç—É—Å</a>
    <a href="zones.html" class="active">–ó–æ–Ω—ã</a>
    <a href="programs.html">–ü—Ä–æ–≥—Ä–∞–º–º—ã</a>
    <a href="logs.html">–õ–æ–≥–∏</a>
    <a href="water.html">–†–∞—Å—Ö–æ–¥</a>
  </nav>
  <main>
    <button class="float-add" onclick="openModal()">‚ûï –ó–æ–Ω–∞</button>
    <table class="zones-table">
      <thead>
        <tr>
          <th><input type="checkbox" id="select-all" onclick="toggleAll(this)"/></th>
          <th>–°—Ç.</th>
          <th>‚Ññ</th>
          <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
          <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
          <th>–ò–∫–æ–Ω–∫–∞</th>
          <th>–î–ª–∏—Ç.</th>
          <th>–ì—Ä—É–ø–ø–∞</th>
          <th>MQTT-—Ç–æ–ø–∏–∫</th>
          <th>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</th>
          <th>–£–¥–∞–ª–∏—Ç—å</th>
        </tr>
      </thead>
      <tbody id="zones-body"></tbody>
    </table>
    <div class="bulk-actions">
      <h3>–ú–∞—Å—Å–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∑–æ–Ω</h3>
      <div class="controls">
        <label>–ò–∫–æ–Ω–∫–∞ <select id="bulkIcon"><option value="">‚Äî</option><option>üåø</option><option>üå≥</option><option>üå∫</option><option>üß±</option></select></label>
        <label>–î–ª–∏—Ç. <input type="number" id="bulkDur" min="1" placeholder="‚Äî"/></label>
        <label>–ì—Ä—É–ø–ø–∞ <select id="bulkGroup"><option value="">‚Äî</option><option>1</option><option>2</option><option>3</option><option>4</option></select></label>
        <button onclick="applyBulk()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
      </div>
    </div>
    <div class="modal" id="zoneModal">
      <div class="modal-content">
        <h3>–°–æ–∑–¥–∞—Ç—å –∑–æ–Ω—É</h3>
        <form id="zoneForm" onsubmit="event.preventDefault(); createZone();">
          <div class="field"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" id="zoneName" required /></div>
          <div class="field"><label>–ò–∫–æ–Ω–∫–∞</label><select id="zoneIcon"><option>üåø</option><option>üå≥</option><option>üå∫</option><option>üß±</option></select></div>
          <div class="field"><label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω)</label><input type="number" id="zoneDur" min="1" required value="10" /></div>
          <div class="field"><label>–ì—Ä—É–ø–ø–∞</label><select id="zoneGroup"><option>1</option><option>2</option><option>3</option><option>4</option></select></div>
          <div class="field"><label>MQTT-—Ç–æ–ø–∏–∫</label><input type="text" id="zoneTopic" placeholder="/devices/.../controls/K1" required /></div>
          <button type="submit" class="create-btn">–°–æ–∑–¥–∞—Ç—å</button>
          <button type="button" class="cancel-btn" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
        </form>
      </div>
    </div>
  </main>
  <footer>–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã –∞–∫—Ç—É–∞–ª–µ–Ω –Ω–∞ 01.05.2025 00:00</footer>
  <script>
    // –î–µ–º–æ-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–æ–Ω: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è 48 –∑–æ–Ω, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–∞—Å—Å–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∏ —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
    const zones = [];
    for(let i=1;i<=48;i++){ zones.push({id:i,state:i===15?'on':'off',name:`–ó–æ–Ω–∞ ${i}`,icon:['üåø','üå≥','üå∫','üß±'][i%4],duration:10,group:Math.floor((i-1)/12)+1,topic:`/devices/wb-mr6c_${100 + Math.floor((i-1)/6)}/controls/K${(i-1)%6 + 1}`}); }
    const tbody = document.getElementById('zones-body');
    function renderZonesTable(){
      tbody.innerHTML='';
      zones.forEach(z => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type='checkbox' class='row-select'/></td>
          <td><span class="indicator ${z.state}"></span></td>
          <td>${z.id}</td>
          <td><button class="start-btn" onclick="startZone(${z.id})">‚ñ∂</button></td>
          <td><input type="text" value="${z.name}" onchange="markChanged(this)" /></td>
          <td><select onchange="markChanged(this)"><option${z.icon==='üåø'?' selected':''}>üåø</option><option${z.icon==='üå≥'?' selected':''}>üå≥</option><option${z.icon==='üå∫'?' selected':''}>üå∫</option><option${z.icon==='üß±'?' selected':''}>üß±</option></select></td>
          <td><input type="number" value="${z.duration}" onchange="markChanged(this)" min="1"/></td>
          <td><select onchange="markChanged(this)"><option${z.group===1?' selected':''}>1</option><option${z.group===2?' selected':''}>2</option><option${z.group===3?' selected':''}>3</option><option${z.group===4?' selected':''}>4</option></select></td>
          <td><input type="text" value="${z.topic}" onchange="markChanged(this)" /></td>
          <td><button class="save-btn" disabled onclick="saveRow(this,${z.id})">üíæ</button></td>
          <td><button class="del-btn" onclick="deleteRow(this,${z.id})">üóëÔ∏è</button></td>
        `;
        tbody.appendChild(tr);
      });
    }
    renderZonesTable();
    function markChanged(el){el.closest('tr').querySelector('.save-btn').disabled=false;}
    function saveRow(btn,id){btn.disabled=true;}
    // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏: –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π event, –ø–µ—Ä–µ–¥–∞–µ–º –∫–Ω–æ–ø–∫—É-–∏—Å—Ç–æ—á–Ω–∏–∫
    function deleteRow(btn,id){if(confirm('–£–¥–∞–ª–∏—Ç—å –∑–æ–Ω—É ‚Ññ'+id+'?'))btn.closest('tr').remove();}
    function startZone(id){alert('–ó–∞–ø—É—â–µ–Ω–∞ –∑–æ–Ω–∞ '+id);}
    function toggleAll(cb){document.querySelectorAll('.row-select').forEach(ch=>ch.checked=cb.checked);}
    // –ú–∞—Å—Å–æ–≤–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤—ã–±–∏—Ä–∞–µ–º —Å–µ–ª–µ–∫—Ç—ã (0 ‚Äî –∏–∫–æ–Ω–∫–∞, 1 ‚Äî –≥—Ä—É–ø–ø–∞)
    function applyBulk(){
      const icon=document.getElementById('bulkIcon').value;
      const dur=document.getElementById('bulkDur').value;
      const grp=document.getElementById('bulkGroup').value;
      document.querySelectorAll('.row-select:checked').forEach(ch=>{
        const row=ch.closest('tr');
        const selects=row.querySelectorAll('select');
        const iconSelect=selects[0];
        const groupSelect=selects[1];
        if(icon!==''){iconSelect.value=icon;}
        if(dur!==''){row.querySelector('input[type=number]').value=dur;}
        if(grp!==''){groupSelect.value=grp;}
        row.querySelector('.save-btn').disabled=false;
      });
    }

    // –ú–æ–¥–∞–ª–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–æ–Ω—ã
    function openModal(){document.getElementById('zoneModal').style.display='flex';}
    function closeModal(){document.getElementById('zoneModal').style.display='none';document.getElementById('zoneForm').reset();}
    function createZone(){
      const name=document.getElementById('zoneName').value.trim();
      const icon=document.getElementById('zoneIcon').value;
      const duration=+document.getElementById('zoneDur').value;
      const group=+document.getElementById('zoneGroup').value;
      const topic=document.getElementById('zoneTopic').value.trim();
      if(!name||!duration||!group||!topic){alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');return;}
      const id=zones.length?Math.max(...zones.map(z=>z.id))+1:1;
      zones.push({id,state:'off',name,icon,duration,group,topic});
      renderZonesTable();
      closeModal();
    }
  </script>
</body>
</html>